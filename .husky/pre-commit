# V√©rifier s'il y a des fichiers stag√©s
if git diff --cached --quiet; then
  echo "Aucun fichier stag√©, skip versioning"
  exit 0
fi

# R√©cup√©rer la derni√®re version tagg√©e
LAST_TAG=$(git describe --tags --abbrev=0 2>/dev/null)

# Si aucun tag n'existe, c'est la premi√®re release
if [ -z "$LAST_TAG" ]; then
  echo "üÜï Premi√®re release d√©tect√©e"
else
  # V√©rifier s'il y a des commits depuis le dernier tag
  COMMITS_SINCE=$(git rev-list ${LAST_TAG}..HEAD --count 2>/dev/null)
  if [ "$COMMITS_SINCE" -eq "0" ]; then
    echo "Aucun nouveau commit depuis ${LAST_TAG}, skip versioning"
    exit 0
  fi
fi

# Ex√©cuter standard-version pour bumper la version
echo "üîÑ Versionnage automatique en cours..."
if npm run release -- --skip.commit --skip.tag; then
  # Ajouter les fichiers modifi√©s par standard-version au commit
  git add package.json package-lock.json CHANGELOG.md
  echo "‚úÖ Version mise √† jour automatiquement"
else
  echo "‚ö†Ô∏è  Erreur lors du versionnage, commit annul√©"
  echo "   Utilisez 'git commit --no-verify' pour bypasser le hook si n√©cessaire"
  exit 1
fi
